# ppop_promt 안정성 개선 테스트 가이드

## 수정 사항 요약

### 1. IPC 핸들러 중복 등록 오류 수정
- **문제**: `check-for-updates` 핸들러가 여러 번 등록되어 오류 발생
- **해결**: IPC 핸들러를 앱 시작 시 한 번만 등록하도록 수정

### 2. 창 닫기 로직 개선
- **Windows/Linux**: X 버튼 클릭 시 백엔드 프로세스까지 완전 종료
- **macOS**: 창을 닫아도 앱은 백그라운드에서 계속 실행 (기본 동작)
- **최소화**: 모든 플랫폼에서 백그라운드 실행 유지

### 3. 백엔드 프로세스 생명주기 관리 개선
- 백엔드 프로세스 확실한 종료 (`killBackendProcess()` 함수)
- Windows: `taskkill /f /t`로 프로세스 트리 전체 종료
- 백엔드 시작 전 기존 프로세스 정리
- 백엔드 예기치 않게 종료 시 사용자에게 알림

### 4. 단일 인스턴스 강제 실행
- 두 번째 인스턴스 실행 시 기존 창 표시
- 백엔드 프로세스 중복 실행 방지

## 테스트 시나리오

### 테스트 1: IPC 핸들러 중복 등록 오류 확인
**목적**: 앱 시작 시 JavaScript 오류가 발생하지 않는지 확인

**절차**:
1. 앱을 실행합니다
2. 개발자 도구를 엽니다 (Ctrl+Shift+I)
3. Console 탭에서 오류 메시지를 확인합니다

**예상 결과**:
- ✅ "Attempted to register a second handler" 오류가 발생하지 않음
- ✅ "IPC 핸들러 등록 중..." 메시지가 한 번만 표시됨

**실제 결과**:
- [ ] 통과
- [ ] 실패 (오류 내용: _________________)

---

### 테스트 2: 앱 다중 실행 방지
**목적**: 앱이 한 번만 실행되는지 확인

**절차**:
1. 앱을 실행합니다
2. 앱이 실행 중인 상태에서 다시 앱을 실행합니다
3. 기존 창이 포커스되는지 확인합니다

**예상 결과**:
- ✅ 두 번째 실행 시 새 창이 열리지 않음
- ✅ 기존 창이 최소화되어 있었다면 복원되고 포커스됨
- ✅ 기존 창이 숨겨져 있었다면 표시되고 포커스됨

**실제 결과**:
- [ ] 통과
- [ ] 실패 (문제점: _________________)

---

### 테스트 3: 창 닫기 시 완전 종료 (Windows/Linux)
**목적**: X 버튼 클릭 시 백엔드까지 완전 종료되는지 확인

**절차**:
1. 앱을 실행합니다
2. 작업 관리자를 엽니다 (Ctrl+Shift+Esc)
3. "세부 정보" 탭에서 `ppop_promt.exe`와 `ppop_promt_backend.exe` 프로세스를 확인합니다
4. 앱 창의 X 버튼을 클릭합니다
5. 작업 관리자에서 두 프로세스가 모두 종료되었는지 확인합니다

**예상 결과**:
- ✅ `ppop_promt.exe` 프로세스가 종료됨
- ✅ `ppop_promt_backend.exe` 프로세스가 종료됨
- ✅ 시스템 트레이 아이콘이 사라짐

**실제 결과**:
- [ ] 통과
- [ ] 실패 (남아있는 프로세스: _________________)

---

### 테스트 4: 최소화 시 백그라운드 실행
**목적**: 최소화 시 백엔드가 계속 실행되는지 확인

**절차**:
1. 앱을 실행합니다
2. 작업 관리자를 엽니다
3. 앱 창을 최소화합니다
4. 작업 관리자에서 `ppop_promt_backend.exe` 프로세스가 여전히 실행 중인지 확인합니다
5. 시스템 트레이 아이콘을 클릭하여 창을 다시 표시합니다

**예상 결과**:
- ✅ 최소화 후에도 `ppop_promt_backend.exe` 프로세스가 실행 중
- ✅ 시스템 트레이 아이콘이 표시됨
- ✅ 트레이 아이콘 클릭 시 창이 다시 표시됨

**실제 결과**:
- [ ] 통과
- [ ] 실패 (문제점: _________________)

---

### 테스트 5: 트레이 메뉴 "종료" 버튼
**목적**: 트레이 메뉴의 "종료" 버튼으로 완전 종료되는지 확인

**절차**:
1. 앱을 실행합니다
2. 작업 관리자를 엽니다
3. 앱 창을 최소화하거나 숨깁니다
4. 시스템 트레이 아이콘을 우클릭합니다
5. "종료" 메뉴를 클릭합니다
6. 작업 관리자에서 두 프로세스가 모두 종료되었는지 확인합니다

**예상 결과**:
- ✅ `ppop_promt.exe` 프로세스가 종료됨
- ✅ `ppop_promt_backend.exe` 프로세스가 종료됨
- ✅ 시스템 트레이 아이콘이 사라짐

**실제 결과**:
- [ ] 통과
- [ ] 실패 (남아있는 프로세스: _________________)

---

### 테스트 6: 백엔드 프로세스 중복 실행 방지
**목적**: 백엔드 프로세스가 중복으로 실행되지 않는지 확인

**절차**:
1. 앱을 실행합니다
2. 작업 관리자를 엽니다
3. "세부 정보" 탭에서 `ppop_promt_backend.exe` 프로세스 개수를 확인합니다
4. 앱을 여러 번 실행 시도합니다
5. 백엔드 프로세스가 여전히 하나만 실행 중인지 확인합니다

**예상 결과**:
- ✅ `ppop_promt_backend.exe` 프로세스가 하나만 실행됨
- ✅ 포트 충돌 오류가 발생하지 않음

**실제 결과**:
- [ ] 통과
- [ ] 실패 (프로세스 개수: _________________)

---

### 테스트 7: 백엔드 예기치 않은 종료 시 알림
**목적**: 백엔드가 예기치 않게 종료될 때 사용자에게 알림이 표시되는지 확인

**절차**:
1. 앱을 실행합니다
2. 작업 관리자에서 `ppop_promt_backend.exe` 프로세스를 강제 종료합니다
3. 앱에서 오류 대화상자가 표시되는지 확인합니다

**예상 결과**:
- ✅ "백엔드 오류" 대화상자가 표시됨
- ✅ "백엔드 서버가 예기치 않게 종료되었습니다" 메시지가 표시됨

**실제 결과**:
- [ ] 통과
- [ ] 실패 (문제점: _________________)

---

## 추가 확인 사항

### 개발자 도구 콘솔 로그 확인
앱 실행 시 다음 로그가 표시되어야 합니다:

```
Electron 앱 시작 중...
IPC 핸들러 등록 중...
시스템 트레이 생성 완료
백엔드 서버 시작 요청 완료
백엔드 실행: [경로]
메인 윈도우 생성 완료
```

창 닫기 시:
```
창 닫기 버튼 클릭 - 앱 완전 종료
백엔드 프로세스 강제 종료 시도...
백엔드 프로세스 종료 완료 (taskkill)
앱 종료 전 정리 작업 시작...
```

### 작업 관리자 프로세스 확인
정상 실행 시:
- `ppop_promt.exe` (1개)
- `ppop_promt_backend.exe` (1개)

완전 종료 후:
- 두 프로세스 모두 없어야 함

## 테스트 결과 요약

| 테스트 | 상태 | 비고 |
|--------|------|------|
| 1. IPC 핸들러 중복 등록 오류 | [ ] | |
| 2. 앱 다중 실행 방지 | [ ] | |
| 3. 창 닫기 시 완전 종료 | [ ] | |
| 4. 최소화 시 백그라운드 실행 | [ ] | |
| 5. 트레이 메뉴 "종료" | [ ] | |
| 6. 백엔드 중복 실행 방지 | [ ] | |
| 7. 백엔드 예기치 않은 종료 알림 | [ ] | |

## 알려진 제한 사항

1. **macOS**: 창 닫기 동작이 Windows/Linux와 다릅니다. macOS에서는 창을 닫아도 앱이 백그라운드에서 계속 실행됩니다 (macOS 표준 동작).

2. **백엔드 종료 지연**: Windows에서 `taskkill` 명령이 실행되는 데 약간의 시간이 걸릴 수 있습니다 (보통 1초 이내).

## 문제 발생 시 확인 사항

1. **백엔드가 종료되지 않는 경우**:
   - 작업 관리자에서 `ppop_promt_backend.exe`를 수동으로 종료
   - 포트 8000-8010이 사용 중인지 확인 (`netstat -ano | findstr :8000`)

2. **앱이 여러 개 실행되는 경우**:
   - 모든 인스턴스를 종료
   - 작업 관리자에서 모든 관련 프로세스 종료
   - 앱을 다시 실행

3. **오류 로그 확인**:
   - 개발자 도구 (Ctrl+Shift+I) 콘솔 탭
   - 백엔드 로그 (콘솔에 "Backend:" 접두사로 표시됨)

